<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>App CP ‚Äì Trouve la lettre</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #fff;
      color: #111;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header, footer {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      padding: 10px 16px;
    }
    .row { display: flex; align-items: center; gap: 12px; }
    .grow { flex: 1 1 auto; }
    button {
      cursor: pointer;
      border: 1px solid #e5e7eb;
      background: #f3f4f6;
      border-radius: 14px;
      padding: 8px 14px;
      font-size: 16px;
    }
    button.primary { background: #2563eb; color: white; border: none; }
    .cards { display: grid; gap: 16px; grid-template-columns: 1fr 1fr; }
    .bigcard {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 22px;
      padding: 20px;
      cursor: pointer;
    }
    .bigcard h3 { margin: 6px 0; }
    .subtitle { color: #6b7280; font-size: 14px; }
    .playzone {
      position: relative;
      width: 100%;
      max-width: 900px;
      height: 500px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 20px;
      margin: 20px auto;
      overflow: hidden;
    }
    .letter-btn {
      position: absolute;
      transform: translate(-50%, -50%);
      border: 2px solid #e5e7eb;
      border-radius: 16px;
      padding: 12px 16px;
      font-size: 28px;
      font-weight: bold;
      background: white;
      min-width: 50px;
      min-height: 50px;
    }
    .good { background: #bbf7d0; border-color: #4ade80; }
    .bad { background: #fecaca; border-color: #f87171; }
    .panel {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 20px;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    .panel h2 { margin-top: 0; }
    label { display: block; margin-bottom: 12px; }
    input, select {
      width: 100%;
      padding: 8px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <header>
    <div class="row">
      <button id="homeBtn">üè† Accueil</button>
      <div class="grow"></div>
      <span id="stars">‚≠ê 0/10</span>
      <button id="teacherBtn">üîß</button>
    </div>
  </header>

  <main id="main" class="container"></main>

  <footer>
    <span class="subtitle">Astuce iPad : ‚ÄúAjouter √† l‚Äô√©cran d‚Äôaccueil‚Äù</span>
  </footer>

  <script>
  window.addEventListener("DOMContentLoaded", () => {
    const STAR_GOAL = 10;
    let stars = 0;
    let settings = {
      targetLetter: "U",
      distractorLetters: "ABCDE",
      itemsCount: 12,
      targetRatio: 0.4,
      letterStyle: "baton"
    };

    const $main = document.getElementById("main");
    const $stars = document.getElementById("stars");
    document.getElementById("homeBtn").onclick = showHome;
    document.getElementById("teacherBtn").onclick = showTeacher;

    showHome();

    function showHome() {
      $main.innerHTML = `
        <div class="cards">
          <div class="bigcard" id="playCard">
            <h3>üîé Trouve la lettre</h3>
            <p class="subtitle">Clique sur tous les exemplaires</p>
          </div>
          <div class="bigcard" id="teachCard">
            <h3>üîß Mode enseignant</h3>
            <p class="subtitle">R√©gler le jeu</p>
          </div>
        </div>`;
      document.getElementById("playCard").onclick = showGame;
      document.getElementById("teachCard").onclick = showTeacher;
    }

    function showGame() {
      $main.innerHTML = "";
      const title = document.createElement("h3");
      title.textContent = `Clique sur tous les ${settings.targetLetter}`;
      $main.appendChild(title);

      const zone = document.createElement("div");
      zone.className = "playzone";
      $main.appendChild(zone);

      const feedback = document.createElement("div");
      $main.appendChild(feedback);

      const letters = makeScatterRound(settings);
      letters.forEach(card => {
        const b = document.createElement("button");
        b.className = "letter-btn";
        b.style.left = card.x + "%";
        b.style.top = card.y + "%";
        b.textContent = card.char;
        zone.appendChild(b);

        b.onclick = () => {
          if (b.classList.contains("good") || b.classList.contains("bad")) return;
          if (card.isTarget) {
            b.classList.add("good");
            if (!zone.querySelectorAll(".letter-btn:not(.good)").length) {
              feedback.textContent = "Bravo ! ‚≠ê";
              stars = Math.min(STAR_GOAL, stars + 1);
              $stars.textContent = `‚≠ê ${stars}/${STAR_GOAL}`;
              setTimeout(showGame, 1000);
            }
          } else {
            b.classList.add("bad");
            feedback.textContent = "Essaie encore";
            setTimeout(() => (feedback.textContent = ""), 700);
          }
        };
      });
    }

    function showTeacher() {
      $main.innerHTML = `
        <div class="panel">
          <h2>R√©glages enseignant</h2>
          <label>Lettre cible
            <input id="target" maxlength="1" value="${settings.targetLetter}">
          </label>
          <label>Lettres distractrices
            <input id="distr" value="${settings.distractorLetters}">
          </label>
          <label>Nombre de cartes
            <input id="count" type="number" min="8" max="24" value="${settings.itemsCount}">
          </label>
          <label>Proportion de bonnes lettres
            <input id="ratio" type="number" step="0.1" min="0.1" max="0.9" value="${settings.targetRatio}">
          </label>
          <label>Style d‚Äô√©criture
            <select id="style">
              <option value="baton">B√¢ton</option>
              <option value="cursif">Cursif</option>
              <option value="script">Script</option>
              <option value="serif">Serif</option>
            </select>
          </label>
          <button class="primary" id="saveBtn">Enregistrer</button>
        </div>`;
      document.getElementById("saveBtn").onclick = () => {
        settings.targetLetter = document.getElementById("target").value.toUpperCase() || "U";
        settings.distractorLetters = document.getElementById("distr").value.toUpperCase() || "ABCDE";
        settings.itemsCount = parseInt(document.getElementById("count").value) || 12;
        settings.targetRatio = parseFloat(document.getElementById("ratio").value) || 0.4;
        settings.letterStyle = document.getElementById("style").value;
        showHome();
      };
    }

    function makeScatterRound(s) {
      const total = s.itemsCount;
      const targetCount = Math.max(1, Math.round(total * s.targetRatio));
      const distractorCount = total - targetCount;
      const target = s.targetLetter.toUpperCase();
      const pool = s.distractorLetters.split("").filter(l => l !== target);

      const chars = [
        ...Array.from({ length: targetCount }, () => target),
        ...Array.from({ length: distractorCount }, () => pool[Math.floor(Math.random() * pool.length)])
      ];

      const placed = [];
      while (placed.length < chars.length) {
        const x = 10 + Math.random() * 80;
        const y = 10 + Math.random() * 80;
        if (placed.every(p => Math.hypot(p.x - x, p.y - y) > 12)) {
          placed.push({ char: chars[placed.length], x, y, isTarget: chars[placed.length] === target });
        }
      }
      return placed;
    }
  });
  </script>
</body>
</html>

